<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LanguageLearningApp.Views.Admin.CoursesManagementPage"
             x:Name="ThisPage"
             Title="Quản lý khóa học">

    <RefreshView IsRefreshing="{Binding IsRefreshing}" Command="{Binding LoadCoursesCommand}">
        <StackLayout Spacing="16" Padding="16">
            <Label Text="QUẢN LÝ KHÓA HỌC" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center"/>
            <Button Text="+ Tạo khóa học mới" Command="{Binding NewCourseCommand}" BackgroundColor="#6366F1" TextColor="White" CornerRadius="8" />

            <CollectionView ItemsSource="{Binding Courses}" SelectedItem="{Binding SelectedCourse, Mode=TwoWay}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="0,8" Padding="10" CornerRadius="14" HasShadow="True" BackgroundColor="#F3F4F6">
                            <StackLayout Orientation="Horizontal" Spacing="10" VerticalOptions="Center">
                                <Image Source="{Binding ImageUrl}" HeightRequest="64" WidthRequest="64" Aspect="AspectFill" />
                                <StackLayout VerticalOptions="Center" Spacing="4" WidthRequest="180">
                                    <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="18" />
                                    <Label Text="{Binding Description}" FontSize="13" TextColor="#6B7280" LineBreakMode="TailTruncation" MaxLines="2" />
                                    <Label Text="{Binding Type}" FontSize="12" TextColor="#6366F1" />
                                </StackLayout>
                                <StackLayout HorizontalOptions="EndAndExpand" Orientation="Horizontal" Spacing="6">
                                    <Button Text="Bài học" Command="{Binding BindingContext.ManageLessonsCommand, Source={x:Reference ThisPage}}" CommandParameter="{Binding .}" FontSize="13" />
                                    <Button Text="Sửa" Command="{Binding BindingContext.SaveCourseCommand, Source={x:Reference ThisPage}}" CommandParameter="{Binding .}" FontSize="13" />
                                    <Button Text="Xóa" Command="{Binding BindingContext.DeleteCourseCommand, Source={x:Reference ThisPage}}" CommandParameter="{Binding .}" FontSize="13" TextColor="Red" />
                                </StackLayout>
                            </StackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Biểu mẫu chỉnh sửa/tạo khóa học -->
            <Frame Padding="16" CornerRadius="16" BackgroundColor="#E0E7FF" IsVisible="{Binding IsEditing}">
                <StackLayout Spacing="10">
                    <Entry Placeholder="Tiêu đề khóa học" Text="{Binding Title}"/>
                    <Editor Placeholder="Mô tả khóa học" Text="{Binding Description}" AutoSize="TextChanges" HeightRequest="60"/>
                    <Picker Title="Loại khóa học" ItemsSource="{Binding CourseTypes}" SelectedItem="{Binding Type}"/>
                    <Stepper Minimum="1" Maximum="10" Increment="1" Value="{Binding DifficultyLevel}"/>
                    <Entry Placeholder="Điểm yêu cầu để mở khóa" Text="{Binding RequiredPoints}" Keyboard="Numeric"/>
                    <Image Source="{Binding ImageUrl}" HeightRequest="100" Aspect="AspectFill"/>
                    <Button Text="Chọn hình ảnh" Command="{Binding PickImageCommand}"/>
                    <Switch IsToggled="{Binding IsPublished}"/>
                    <StackLayout Orientation="Horizontal" HorizontalOptions="EndAndExpand" Spacing="10">
                        <Button Text="Lưu" Command="{Binding SaveCourseCommand}" BackgroundColor="#22C55E" TextColor="White" />
                        <Button Text="Hủy" Command="{Binding CancelEditCommand}" BackgroundColor="#EF4444" TextColor="White" />
                    </StackLayout>
                </StackLayout>
            </Frame>

            <Label Text="{Binding ErrorMessage}" TextColor="Red" FontAttributes="Italic" 
                   IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>
        </StackLayout>
    </RefreshView>
</ContentPage>
